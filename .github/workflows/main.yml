name: Build DLL
on: push     
jobs:
  build_dll:
          runs-on: windows-latest
          steps:
                  - name: Checkout
                    uses: actions/checkout@v2
                    with:
                      submodules: 'recursive'
                  - name: vcpkg cache
                    uses: actions/cache@v1
                    id: cache-vcpkg
                    with:
                      path: vcpkg
                      # if the vcpkg hash or the set of dependencies change,
                      # restore the most recently saved cache for the environment
                      # if the build environment changes then start from scratch
                      key: vcpkg-${{ hashFiles('**/vcpkg.txt') }}
                  - name: run-vcpkg
                    if: steps.cache-vcpkg.outputs.cache-hit != 'true'
                    uses: lukka/run-vcpkg@v3.2
                    with:
                        vcpkgDirectory: '${{ github.workspace }}/vcpkg'
                        vcpkgArguments: '@${{ github.workspace }}/vcpkg.txt'
                        cleanAfterBuild: false
                  - name: Setup MSBuild
                    uses: microsoft/setup-msbuild@v1.0.2
                  - name: Check dependencies
                    run: 'ls ${{ github.workspace }}/vcpkg/installed/x86-windows-static'
                  - name: Build DLL
                    run: 'msbuild SimpleGraphic.vcxproj /p:configuration=release /p:platform=win32'
                  - name: Archive DLL
                    uses: actions/upload-artifact@v2
                    with:
                        name: SimpleGraphic.dll
                        path: '${{ github.workspace }}/Release/SimpleGraphic.dll'
